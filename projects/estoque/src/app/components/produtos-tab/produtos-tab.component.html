<div class="produtos-container">
  <div class="form-section">
    <h2>{{ editando ? 'Editar Produto' : 'Adicionar Novo Produto' }}</h2>
    <div class="form-grid">
      <div class="form-group">
        <label for="nome">Nome do Produto *</label>
        <input
          type="text"
          id="nome"
          [(ngModel)]="nome"
          placeholder="Ex: Tomate Cereja"
          class="form-input">
      </div>
      <div class="form-group">
        <label for="categoria">Categoria *</label>
        <select
          id="categoria"
          [(ngModel)]="categoria"
          class="form-input">
          <option value="">Selecione uma categoria</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="precoCusto">Pre√ßo de Custo (R$) *</label>
        <input
          type="number"
          id="precoCusto"
          [(ngModel)]="precoCusto"
          step="0.01"
          min="0"
          placeholder="0.00"
          class="form-input">
      </div>
      <div class="form-group">
        <label for="precoVenda">Pre√ßo de Venda (R$) *</label>
        <input
          type="number"
          id="precoVenda"
          [(ngModel)]="precoVenda"
          step="0.01"
          min="0"
          placeholder="0.00"
          class="form-input">
      </div>
      <div class="form-group">
        <label for="quantidade">Quantidade em Estoque *</label>
        <input
          type="number"
          id="quantidade"
          [(ngModel)]="quantidade"
          min="0"
          placeholder="0"
          class="form-input">
      </div>
      <div class="form-group">
        <label for="unidade">Unidade</label>
        <select
          id="unidade"
          [(ngModel)]="unidade"
          class="form-input">
          <option value="kg">Quilograma (kg)</option>
          <option value="g">Grama (g)</option>
          <option value="l">Litro (l)</option>
          <option value="ml">Mililitro (ml)</option>
          <option value="un">Unidade (un)</option>
          <option value="cx">Caixa (cx)</option>
          <option value="pct">Pacote (pct)</option>
        </select>
      </div>
    </div>
    <div class="form-group full-width">
      <label for="descricao">Descri√ß√£o</label>
      <textarea
        id="descricao"
        [(ngModel)]="descricao"
        placeholder="Descri√ß√£o detalhada do produto..."
        rows="3"
        class="form-input"></textarea>
    </div>
    <div class="form-actions">
      <button
        *ngIf="!editando"
        (click)="adicionarProduto()"
        class="btn btn-primary"
        [disabled]="!validarProduto()">
        <span>‚ûï</span> Adicionar Produto
      </button>
      <div *ngIf="editando" class="edit-actions">
        <button (click)="salvarEdicao()" class="btn btn-success">
          <span>üíæ</span> Salvar Altera√ß√µes
        </button>
        <button (click)="cancelarEdicao()" class="btn btn-secondary">
          <span>‚ùå</span> Cancelar
        </button>
      </div>
    </div>
  </div>
  <div class="table-section">
    <div class="table-header">
      <h2>üì¶ Produtos Cadastrados ({{ produtos.length }})</h2>
      <div class="table-actions">
        <button (click)="carregarProdutos()" class="btn btn-outline">
          <span>üîÑ</span> Atualizar
        </button>
      </div>
    </div>
    <div class="table-container">
      <table class="products-table">
        <thead>
          <tr>
            <th>Produto</th>
            <th>Categoria</th>
            <th>Pre√ßo Custo</th>
            <th>Pre√ßo Venda</th>
            <th>Lucro</th>
            <th>Margem</th>
            <th>Estoque</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let produto of produtos" class="product-row">
            <td>
              <div class="product-info">
                <strong>{{ produto.nome }}</strong>
                <small *ngIf="produto.descricao">{{ produto.descricao }}</small>
              </div>
            </td>
            <td>
              <span class="category-badge">{{ produto.categoria }}</span>
            </td>
            <td>R$ {{ produto.precoCusto | number:'1.2-2' }}</td>
            <td>R$ {{ produto.precoVenda | number:'1.2-2' }}</td>
            <td>
              <span class="profit" [class.positive]="calcularLucro(produto.precoVenda, produto.precoCusto) > 0">
                R$ {{ calcularLucro(produto.precoVenda, produto.precoCusto) | number:'1.2-2' }}
              </span>
            </td>
            <td>
              <span class="margin" [class.positive]="calcularMargemLucro(produto.precoVenda, produto.precoCusto) > 0">
                {{ calcularMargemLucro(produto.precoVenda, produto.precoCusto) | number:'1.1-1' }}%
              </span>
            </td>
            <td>
              <span class="stock" [class.low]="produto.quantidade < 10">
                {{ produto.quantidade }} {{ produto.unidade }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button (click)="editarProduto(produto)" class="btn-icon btn-edit" title="Editar">
                  ‚úèÔ∏è
                </button>
                <button (click)="excluirProduto(produto.id!)" class="btn-icon btn-delete" title="Excluir">
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="produtos.length === 0" class="empty-state">
        <div class="empty-icon">üì¶</div>
        <h3>Nenhum produto cadastrado</h3>
        <p>Adicione seu primeiro produto usando o formul√°rio acima!</p>
      </div>
    </div>
  </div>
</div>
